server {
    listen [::]:443 quic;
    listen 443 quic;
    listen [::]:443 ssl;
    listen 443 ssl;
    http2 on;

    server_name         {{ xray_server_name }};

    error_page 497 =307 https://$host$request_uri;

    client_max_body_size 10G;
    ssl_certificate     /etc/letsencrypt/live/{{ xray_server_name }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ xray_server_name }}/privkey.pem;

    add_header Alt-Svc 'h3=":443"; ma=86400' always;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header Content-Security-Policy "default-src 'self'; object-src 'none'; base-uri 'none'; frame-ancestors 'self'" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "accelerometer=(), geolocation=(), microphone=()" always;

    location /{{ xray_location }} {
        grpc_pass grpc://127.0.0.1:65055;
        grpc_set_header Host $host;
        grpc_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        grpc_read_timeout 3600s;
        grpc_send_timeout 3600s;
    }

    location / {
        autoindex       off;
        index           index.html;
        root            /var/www/html/;
        max_ranges      1000000000000000;
    }
}
